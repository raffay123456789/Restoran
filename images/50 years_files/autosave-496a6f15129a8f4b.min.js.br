"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="b2d002fd-69ac-5a1d-ad4e-5e097816ee03")}catch(e){}}();
(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[5817],{879126:(e,a,t)=>{t.d(a,{AX:()=>_,Ay:()=>d,DA:()=>v,DD:()=>s,Fz:()=>g,IC:()=>x,MV:()=>m,Ns:()=>y,O2:()=>u,QW:()=>A,Vw:()=>h,Vz:()=>c,dd:()=>r,eX:()=>o,fH:()=>p,hL:()=>f,ho:()=>i,jO:()=>N,ns:()=>k,r_:()=>E,rf:()=>n,yl:()=>l});let l="autosave_modal--modal--Egqg3",s="autosave_modal--title--Q-T-o",n="autosave_modal--body--pv4yP",o="autosave_modal--fileRows--JQWy9",i="autosave_modal--fileRow--vBNLB",r="autosave_modal--userRows--fG3Qq",c="autosave_modal--onlyFileRow--yr2jI autosave_modal--fileRow--vBNLB autosave_modal--body--pv4yP",m="autosave_modal--onlyFileRowText--NGT-7",u="autosave_modal--userTitle--lEP2M ellipsis--ellipsis--Tjyfa text--fontPos11--2LvXf text--_fontBase--QdLsd",d="autosave_modal--fileMetadata--JIecy",v="autosave_modal--fileTitle--L9HsU ellipsis--ellipsis--Tjyfa",f="autosave_modal--fileLastUpdatedAt--ZL15q ellipsis--ellipsis--Tjyfa text--fontPos11--2LvXf text--_fontBase--QdLsd",_="autosave_modal--logOutButtons--961-N",E="autosave_modal--logOutDiscard--MvTW-",g="autosave_modal--logOutDone--cjhVr autosave_modal--flexRowEnd--UaYDp",y="autosave_modal--doneAndSync---UvWx autosave_modal--flexRowEnd--UaYDp",N="autosave_modal--expiryAndDone--ck-oP",h="autosave_modal--done--F-hm3",p="autosave_modal--expiryWrapper--1Ee1U",x="autosave_modal--expiry--E2Ybr",A="autosave_modal--warningIcon--T1wLu",k="autosave_modal--openToSync--KQUfj"},275081:(e,a,t)=>{t.r(a),t.d(a,{AutosaveLearnMoreModal:()=>v});var l=t(411855),s=t(188507),n=t(504440),o=t(966712),i=t(799569),r=t(946689),c=t(939863),m=t(662275),u=t(488578),d=t(879126);function v({userInOrg:e}){let a=(0,s.wA)(),t=()=>{a(m.Ce())},v=(0,o.kc)().ss_fpl_multiplayer?l.createElement(n.$n,{variant:"secondary",onClick:t},(0,c.tx)("autosave.learn_more.done_button")):l.createElement(r.nR,{onClick:t,className:d.Vw},(0,c.tx)("autosave.learn_more.done_button"));return l.createElement(u.aF,{className:d.yl},l.createElement(i.s_,{dispatch:a}),l.createElement("div",{className:d.DD},(0,c.tx)("autosave.learn_more.title")),l.createElement("div",{className:d.rf},(0,c.tx)("autosave.learn_more.body_save_pending_changes")),l.createElement("div",{className:d.rf},(0,c.tx)("autosave.learn_more.body_use_version_history")),l.createElement("div",{className:d.Fz},v))}},714932:(e,a,t)=>{t.r(a),t.d(a,{AutosaveLogOutModal:()=>W,HasAutosaveChangesModal:()=>I});var l=t(411855),s=t(188507),n=t(459401),o=t(675678),i=t(677469),r=t.n(i),c=t(297666),m=t(517333),u=t(737947),d=t(776621),v=t(799569),f=t(946689),_=t(564577),E=t(163023),g=t(331737),y=t(842262),N=t(869381),h=t(901536),p=t(939863),x=t(119198),A=t(662275),k=t(788811),w=t(823699),D=t(63104),F=t(132367),b=t(860178),C=t(132135),O=t(565167),L=t(945020),T=t(754168),M=t(488578),R=t(879126),S=t(247866);function U(e){return e.user?l.createElement("div",{className:R.O2},l.createElement("p",null,e.user.community_profile_handle||e.user.email)):null}async function j(e,a){let t=!1,l=null;try{let{data:s}=await T.S.getFiles({includePerms:!0,fileKey:a.fileKey,args:{headers:{"X-Figma-User-ID":e}}});(l=s.meta)&&(l.deleted_at||!l.can_edit_canvas)&&(t=!0)}catch(e){404===e.status?t=!0:(0,d.Lo)("Autosave","Failed to retrieve information about autosave file")}return{userID:e,shouldDeleteFile:t,unsyncedFile:a,figFile:l}}let B=(e,a)=>(0,c.s)(()=>{let t=new URL((0,C.r1)(e,!0));t.searchParams.append("fuid",a),u.Ay.redirect(t.toString(),"_blank")}),z=(e,a)=>(0,c.s)(()=>e(x.NA({file:a,openNewFileIn:L.ai.NEW_TAB,source:O.U.AUTOSAVE_MODAL})));function V(e,a,t){return(0,D.y8)(a)?{fileName:a.file.name,onClick:B(a.file,t.id),thumbnail:l.createElement(g.NU,{file:a.file,size:N.y.SMALL,borderRadius:4})}:{fileName:a.name,onClick:z(e,a),thumbnail:l.createElement(y.A,{listView:"slightly-larger"})}}function $(e){let{fileName:a,onClick:t,thumbnail:n}=V((0,s.wA)(),e.fileState,e.user);return l.createElement("div",{className:R.ho,key:e.fileState.fileKey},l.createElement("div",{className:h.cx.hFull.$},n),l.createElement("div",{className:R.Ay},l.createElement("div",{className:R.DA},a),l.createElement("div",{className:R.hL},(0,p.tx)("tile.file_tile.edited_time",{time:l.createElement(_.h1,{date:e.fileState.lastUpdatedAt})}))),l.createElement(f.nR,{className:R.ns,onClick:t},(0,p.tx)("autosave.has_changes.open_to_sync")))}function P(e){return l.createElement("div",{className:R.dd},Object.keys(e.files).map(a=>l.createElement("div",{key:a,className:R.eX},l.createElement(U,{user:e.users.filter(e=>e?.id===a)[0]}),l.createElement("div",null,Object.values(e.files[a]).map(t=>l.createElement($,{fileState:t,user:e.users.filter(e=>e?.id===a)[0],key:t.fileKey}))))))}function G(e,a,t,s,n,o){let i;let c=o||(()=>{e(A.Ce())}),m=Q(t),u=1===r()(Object.values(a)).length,d=null,_=null,g=null,y=null,N=null;if(u){d=r()(Object.values(a))[0];let t=Object.keys(a).filter(e=>a[e].length>0)[0],n=V(e,d,_=s.filter(e=>e?.id===t)[0]);g=n.fileName,y=n.onClick,N=n.thumbnail,i=l.createElement("div",null,l.createElement(U,{user:_}),l.createElement("div",{className:R.Vz},l.createElement("div",{className:h.cx.hFull.$},N),l.createElement("div",{className:R.MV},(0,p.tx)("autosave.has_changes.unsaved_changes_to_file",{fileName:l.createElement("span",{className:R.DD},g)}))))}else i=l.createElement("div",null,l.createElement("div",{className:R.rf},(0,p.tx)("autosave.has_changes.unsynced_changes_offline")),l.createElement(P,{files:a,users:s}));return l.createElement(M.aF,{className:R.yl,size:500,tintedModalBackground:!0},l.createElement(v.s_,{dispatch:e}),l.createElement("div",{className:R.DD},(0,p.tx)("autosave.has_changes.sync_offline_changes")),i,m||n||u?l.createElement("div",{className:R.jO},m&&l.createElement("div",{className:R.fH},l.createElement(E.B,{svg:S.A,className:R.QW}),l.createElement("div",{className:R.IC},m)),l.createElement("div",{className:R.Ns},n?l.createElement(f.nR,{onClick:c},(0,p.tx)("autosave.has_changes.dismiss.later")):null,u&&y&&l.createElement(f.$$,{onClick:y},(0,p.tx)("autosave.has_changes.open_to_sync")))):null)}function I(){let e=(0,s.wA)(),{unsyncedFiles:a,localUnsyncedFiles:t}=(0,k.Gg)(),l=(0,s.d4)(e=>e.modalShown),n=(0,s.d4)(e=>e.autosave.nextGarbageCollectionTimestamp),o=(0,b.iZ)(),i=o?.id;return l&&i&&o?G(e,{[i]:[...a,...t]},n,[o],!0):null}function K(e){let a=(0,s.wA)(),[t,n]=l.useState(!1),[o,i]=l.useState(!1),r=async()=>{try{for(let a of e.users){let e=a?.id;e&&await (0,k.go)((0,w.cu)(e))}}finally{i(!0)}},c=()=>{n(!0)};if(o)return l.createElement(M.aF,{className:R.yl,size:384,tintedModalBackground:!0},l.createElement(v.s_,{dispatch:a}),l.createElement("div",{className:R.DD},(0,p.tx)("autosave.logout.offline_changes")),l.createElement("div",{className:R.rf},(0,p.tx)("autosave.logout.offline_changes_discarded")),l.createElement("div",{className:R.Vw},l.createElement(f.nR,{onClick:e.onLogOut},(0,p.tx)("autosave.logout.log_out"))));if(0===Object.values(e.files).length&&e.loaded)return l.createElement(M.aF,{className:R.yl,size:384,tintedModalBackground:!0},l.createElement(v.s_,{dispatch:a}),l.createElement("div",{className:R.DD},(0,p.tx)("autosave.logout.offline_changes")),l.createElement("div",{className:R.rf},(0,p.tx)("autosave.logout.offline_changes_synced")),l.createElement("div",{className:R.Vw},l.createElement(f.nR,{onClick:e.onLogOut},(0,p.tx)("autosave.logout.log_out"))));if(t)return G(a,e.files,e.nextGarbageCollectionTimestamp,e.users,!1,()=>{n(!1)});{let t;let s=m.eD?(0,p.t)("autosave.logout.log_out_text.desktop"):(0,p.t)("autosave.logout.log_out_text.web");return t=m.eD?l.createElement("div",{className:R.AX},l.createElement("div",{className:R.r_},l.createElement(f.s6,{onClick:r},(0,p.tx)("autosave.logout.discard_and_logout"))),l.createElement("div",{className:R.Fz},l.createElement(f.nR,{onClick:()=>{a(A.Lo())}},(0,p.tx)("autosave.logout.cancel")),l.createElement(f.nR,{onClick:c},(0,p.tx)("autosave.logout.show_changes")))):l.createElement("div",{className:R.AX},l.createElement("div",{className:R.r_},l.createElement(f.s6,{onClick:r},(0,p.tx)("autosave.logout.discard"))),l.createElement("div",{className:R.Fz},l.createElement(f.nR,{onClick:e.onLogOut},(0,p.tx)("autosave.logout.log_out")),l.createElement(f.$$,{onClick:c},(0,p.tx)("autosave.logout.sync_changes")))),l.createElement(M.aF,{className:R.yl,size:424,tintedModalBackground:!0},l.createElement(v.s_,{dispatch:a}),l.createElement("div",{className:R.DD},(0,p.tx)("autosave.has_changes.sync_offline_changes")),l.createElement("div",{className:R.rf},s),t)}}function W(e){let{multiUserUnsyncedFiles:a,multiUserGarbageCollectionTimestamp:t,loaded:i,autosaveFilesToDelete:r}=function(e){let a=(0,s.wA)(),[t,i]=l.useState({multiUserGarbageCollectionTimestamp:0,multiUserUnsyncedFiles:{},loaded:!1,autosaveFilesToDelete:[]});return l.useEffect(()=>{let a=async()=>{try{let a=await (0,k.ZW)((0,n.removeNullish)(e.map(e=>e?.id))),t={},l=[],s=[];for(let[e,l]of Object.entries(a)){for(let a of l.unsyncedFiles)s.push(j(e,a));for(let a of l.newFiles)e in t||(t[e]=[]),t[e].push(a)}for(let e of(await Promise.all(s))){let a=e.userID;e.shouldDeleteFile?l.push({userID:a,fileKey:e.unsyncedFile.fileKey}):e.figFile&&(a in t||(t[a]=[]),t[a].push({type:"autosave-file",fileKey:e.figFile.key,lastUpdatedAt:e.unsyncedFile.lastUpdatedAt,file:e.figFile}))}let o=Math.min(...Object.values(a).map(e=>e.nextGarbageCollectionTimestamp));i({multiUserGarbageCollectionTimestamp:o,multiUserUnsyncedFiles:t,loaded:!0,autosaveFilesToDelete:l})}catch(e){e instanceof Error?((0,d.x1)("Autosave","Failed to call autosave callback",{name:e.name,message:e.message}),(0,d.$D)(o.FigmaTeam.SCENEGRAPH_AND_SYNC,e)):(0,d.$D)(o.FigmaTeam.SCENEGRAPH_AND_SYNC,Error("Failed to call autosave callback"))}};return F.hp.register(F.a,a),a(),function(){F.hp.unregister(F.a,a)}},[a,e]),t}(e.users);return(0,b.TA)()?l.createElement(K,{loaded:i,nextGarbageCollectionTimestamp:t,files:a,onLogOut:()=>{for(let e of r)(0,k.go)((0,w.Zt)(e.userID,e.fileKey)).catch(e=>{(0,d.$D)(o.FigmaTeam.UNOWNED,Error("Failed to delete autosave data for sessions"))});e.onLogOut()},users:e.users}):null}I.displayName="HasAutosaveChangesModal";let Q=e=>{let a=Math.floor(((0,k.bD)()-(Date.now()-e))/864e5);return a>5?null:a<1?(0,p.tx)("autosave.has_changes.expiry_text_shortly"):(0,p.tx)("autosave.has_changes.expiry_text_days",{days:a})};W.displayName="AutosaveLogOutModal"},528752:(e,a,t)=>{t.r(a),t.d(a,{AutosaveNewFileAlreadyOpenModal:()=>f});var l=t(411855),s=t(188507),n=t(504440),o=t(776250),i=t(966712),r=t(946689),c=t(901536),m=t(939863),u=t(662275),d=t(488578),v=t(879126);function f(e){let a=(0,s.wA)();(0,l.useEffect)(()=>(0,o.sx)("New Autosave File Already Open Modal Shown"));let t=()=>a(u.Ce());return l.createElement(d.aF,{size:360,tintedModalBackground:!0},l.createElement("div",{className:v.DD},(0,m.tx)("autosave.file_already_open_modal.title")),l.createElement("div",{className:v.rf},(0,m.tx)("autosave.file_already_open_modal.body",{fileName:l.createElement("span",{className:c.cx.fontSemiBold.$},e.file.name)})),l.createElement("div",{className:v.Vw},(0,i.kc)().ss_fpl_multiplayer?l.createElement(n.$n,{variant:"secondary",onClick:t},(0,m.tx)("general.ok")):l.createElement(r.nR,{onClick:t},(0,m.tx)("general.ok"))))}f.displayName="AutosaveNewFileAlreadyOpenModal"}}]);

//# debugId=b2d002fd-69ac-5a1d-ad4e-5e097816ee03

//# sourceMappingURL=https://admin.figma.com/admin/webpack-artifacts/4dabab4f453465ea80bc598b024d33e8096bb066/autosave-496a6f15129a8f4b.min.js.map